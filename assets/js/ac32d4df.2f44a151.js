"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[17498],{14082:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>s,metadata:()=>a,toc:()=>l});var i=t(74848),r=t(28453);const s={title:"Bind ports",sidebar_label:"Bind ports",sidebar_position:3,slug:"/ibc/apps/bindports"},o="Bind ports",a={id:"ibc/apps/bindports",title:"Bind ports",description:"Learn what changes to make to bind modules to their ports on initialization.",source:"@site/docs/01-ibc/03-apps/03-bindports.md",sourceDirName:"01-ibc/03-apps",slug:"/ibc/apps/bindports",permalink:"/main/ibc/apps/bindports",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Bind ports",sidebar_label:"Bind ports",sidebar_position:3,slug:"/ibc/apps/bindports"},sidebar:"defaultSidebar",previous:{title:"Implement IBCModule interface and callbacks",permalink:"/main/ibc/apps/ibcmodule"},next:{title:"Keeper",permalink:"/main/ibc/apps/keeper"}},d={},l=[{value:"Pre-requisite readings",id:"pre-requisite-readings",level:2}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"bind-ports",children:"Bind ports"}),"\n",(0,i.jsx)(n.admonition,{title:"Synopsis",type:"note",children:(0,i.jsx)(n.p,{children:"Learn what changes to make to bind modules to their ports on initialization."})}),"\n",(0,i.jsxs)(n.admonition,{type:"note",children:[(0,i.jsx)(n.h2,{id:"pre-requisite-readings",children:"Pre-requisite readings"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/main/ibc/overview",children:"IBC Overview"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/main/ibc/integration",children:"IBC default integration"})}),"\n"]})]}),"\n",(0,i.jsx)(n.p,{children:"Currently, ports must be bound on app initialization. In order to bind modules to their respective ports on initialization, the following needs to be implemented:"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:["Note that ",(0,i.jsx)(n.code,{children:"portID"})," does not refer to a certain numerical ID, like ",(0,i.jsx)(n.code,{children:"localhost:8080"})," with a ",(0,i.jsx)(n.code,{children:"portID"})," 8080. Rather it refers to the application module the port binds. For IBC Modules built with the Cosmos SDK, it defaults to the module's name and for Cosmwasm contracts it defaults to the contract address."]}),"\n"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Add port ID to the ",(0,i.jsx)(n.code,{children:"GenesisState"})," proto definition:"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-protobuf",children:"message GenesisState {\n  string port_id = 1;\n  // other fields\n}\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Add port ID as a key to the module store:"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// x/<moduleName>/types/keys.go\nconst (\n  // ModuleName defines the IBC Module name\n  ModuleName = "moduleName"\n\n  // Version defines the current version the IBC\n  // module supports\n  Version = "moduleVersion-1"\n\n  // PortID is the default port id that module binds to\n  PortID = "portID"\n\n  // ...\n)\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsxs)(n.li,{children:["Add port ID to ",(0,i.jsx)(n.code,{children:"x/<moduleName>/types/genesis.go"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:'// in x/<moduleName>/types/genesis.go\n\n// DefaultGenesisState returns a GenesisState with "portID" as the default PortID.\nfunc DefaultGenesisState() *GenesisState {\n  return &GenesisState{\n    PortId:      PortID,\n    // additional k-v fields\n  }\n}\n\n// Validate performs basic genesis state validation returning an error upon any\n// failure.\nfunc (gs GenesisState) Validate() error {\n  if err := host.PortIdentifierValidator(gs.PortId); err != nil {\n    return err\n  }\n  //additional validations\n\n  return gs.Params.Validate()\n}\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"4",children:["\n",(0,i.jsxs)(n.li,{children:["Set the port in the module keeper's for ",(0,i.jsx)(n.code,{children:"InitGenesis"}),":"]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsx)(n.p,{children:"The capability module has been removed so port binding has also changed"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-go",children:"// SetPort sets the portID for the transfer module. Used in InitGenesis\nfunc (k Keeper) SetPort(ctx sdk.Context, portID string) {\n\tstore := k.storeService.OpenKVStore(ctx)\n\tif err := store.Set(types.PortKey, []byte(portID)); err != nil {\n\t\tpanic(err)\n\t}\n}\n\n  // Initialize any other module state, like params with SetParams.\nfunc (k Keeper) SetParams(ctx sdk.Context, params types.Params) {\n\tstore := k.storeService.OpenKVStore(ctx)\n\tbz := k.cdc.MustMarshal(&params)\n\tif err := store.Set([]byte(types.ParamsKey), bz); err != nil {\n\t\tpanic(err)\n\t}\n}\n  // ...\n\n"})}),"\n",(0,i.jsx)(n.p,{children:"The module is set to the desired port. The setting and sealing happens during creation of the IBC router."})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},28453:(e,n,t)=>{t.d(n,{R:()=>o,x:()=>a});var i=t(96540);const r={},s=i.createContext(r);function o(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(s.Provider,{value:n},e.children)}}}]);